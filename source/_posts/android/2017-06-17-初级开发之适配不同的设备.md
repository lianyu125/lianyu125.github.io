---
title: 安卓初级开发之适配不同的设备
category: Android
tags: Android
keywords: Android
description: 全球的Android设备有着各种各样的大小和尺寸。通过各种各样的设备类型，能使我们通过自己的app接触到广大的用户群体。为了能在各种Android平台上使用，我们的app需要兼容各种不同的设备类型。某些例如语言，屏幕尺寸，Android的系统版本等重要的变量因素需要重点考虑。本课程会教我们如何使用基础的平台功能，利用替代资源和其他功能，使app仅用一个app程序包(APK)，就能向用Android兼容设备的用户提供最优的用户体验。
---

## 适配不同的屏幕
Android用尺寸和分辨率这两种常规属性对不同的设备屏幕加以分类。我们应该想到自己的app会被安装在各种屏幕尺寸和分辨率的设备中。这样，app中就应该包含一些可选资源，针对不同的屏幕尺寸和分辨率，来优化其外观。
有4种普遍尺寸：小(small)，普通(normal)，大(large)，超大(xlarge)
4种普遍分辨率：低精度(ldpi), 中精度(mdpi), 高精度(hdpi), 超高精度(xhdpi)
声明针对不同屏幕所用的layout和bitmap，必须把这些可选资源放置在独立的目录中，这与适配不同语言时的做法类似。
同样要注意屏幕的方向(横向或纵向)也是一种需要考虑的屏幕尺寸变化，因此许多app会修改layout，来针对不同的屏幕方向优化用户体验。
### 创建不同的layout 
为了针对不同的屏幕去优化用户体验，我们需要为每一种将要支持的屏幕尺寸创建唯一的XML文件。每一种layout需要保存在相应的资源目录中，目录以-<screen_size>为后缀命名。例如，对大尺寸屏幕(large screens)，一个唯一的layout文件应该保存在res/layout-large/中。

-------
【注】为了匹配合适的屏幕尺寸Android会自动地测量我们的layout文件。所以不需要因不同的屏幕尺寸去担心UI元素的大小，而应该专注于layout结构对用户体验的影响。(比如关键视图相对于同级视图的尺寸或位置)
例如，这个工程包含一个默认layout和一个适配大屏幕的layout：
```java
MyProject/
    res/
        layout/
            main.xml
        layout-large/
            main.xml
```
layout文件的名字必须完全一样，为了对相应的屏幕尺寸提供最优的UI，文件的内容不同。
如平常一样在app中简单引用：
```java
@Override
 protected void onCreate(Bundle savedInstanceState) {
     super.onCreate(savedInstanceState);
     setContentView(R.layout.main);
}
```
系统会根据app所运行的设备屏幕尺寸，在与之对应的layout目录中加载layout。更多关于Android如何选择恰当资源的信息，详见[Providing Resources](https://developer.android.com/guide/topics/resources/providing-resources.html#BestMatch)。
另一个例子，这一个工程中有为适配横向屏幕的layout:
```java
MyProject/
    res/
        layout/
            main.xml
        layout-land/
            main.xml
```
默认的，layout/main.xml文件用作竖屏的layout。
如果想给横屏提供一个特殊的layout，也适配于大屏幕，那么则需要使用large和land修饰符。

```java
 MyProject/
    res/
        layout/              # default (portrait)
            main.xml
        layout-land/         # landscape
            main.xml
        layout-large/        # large (portrait)
            main.xml
        layout-large-land/   # large landscape
            main.xml
```
### 创建不同的bitmap
我们应该为4种普遍分辨率:低，中，高，超高精度，都提供相适配的bitmap资源。这能使我们的app在所有屏幕分辨率中都能有良好的画质和效果。
要生成这些图像，应该从原始的矢量图像资源着手，然后根据下列尺寸比例，生成各种密度下的图像。
**xhdpi: 2.0
hdpi: 1.5
mdpi: 1.0 (基准)
ldpi: 0.75
**
这意味着，如果针对xhdpi的设备生成了一张200x200的图像，那么应该为hdpi生成150x150,为mdpi生成100x100, 和为ldpi生成75x75的图片资源。然后，将这些文件放入相应的drawable资源目录中:
```
MyProject/
    res/
        drawable-xhdpi/
            awesomeimage.png
        drawable-hdpi/
            awesomeimage.png
        drawable-mdpi/
            awesomeimage.png
        drawable-ldpi/
            awesomeimage.png
```
任何时候，当引用@drawable/awesomeimage时系统会根据屏幕的分辨率选择恰当的bitmap。
【注】低密度(ldpi)资源是非必要的，当提供了hdpi的图像，系统会把hdpi的图像按比例缩小一半，去适配ldpi的屏幕
## 适配不同的系统版本
新的Android版本会为我们的app提供更棒的APIs，但我们的app仍应支持旧版本的Android，直到更多的设备升级到新版本为止。这节课程将展示如何在利用新的APIs的同时仍支持旧版本Android。
[Platform Versions](https://developer.android.com/about/dashboards/index.html)的控制面板会定时更新，通过统计访问Google Play Store的设备数量，来显示运行每个版本的安卓设备的分布。一般情况下，在更新app至最新Android版本时，最好先保证新版的app可以支持90%的设备使用。
【建议】为了能在几个Android版本中都能提供最好的特性和功能，应该在我们的app中使用[Android Support Library](https://developer.android.com/topic/libraries/support-library/index.html)，它能使我们的app能在旧平台上使用最近的几个平台的APIs。
### 指定最小和目标API级别
[AndroidManifest.xml](https://developer.android.com/guide/topics/manifest/manifest-intro.html)文件中描述了我们的app的细节及app支持哪些Android版本。具体来说，<uses-sdk>元素中的minSdkVersion和targetSdkVersion 属性，标明在设计和测试app时，最低兼容API的级别和最高适用的API级别(这个最高的级别是需要通过我们的测试的)。例如
```xml
<manifest xmlns:android="http://schemas.android.com/apk/res/android" ... >
    <uses-sdk android:minSdkVersion="4" android:targetSdkVersion="15" />
    ...
</manifest>
```
随着新版本Android的发布，一些风格和行为可能会改变，为了能使app能利用这些变化，而且能适配不同风格的用户的设备，我们应该将targetSdkVersion的值尽量的设置与最新可用的Android版本匹配。
### 运行时检查系统版本
Android在[Build](https://developer.android.com/reference/android/os/Build.html)常量类中提供了对每一个版本的唯一代号，在我们的app中使用这些代号可以建立条件，保证依赖于高级别的API的代码，只会在这些API在当前系统中可用时，才会执行。
```java
private void setUpActionBar() {
    // Make sure we're running on Honeycomb or higher to use ActionBar APIs
    if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.HONEYCOMB) {
        ActionBar actionBar = getActionBar();
        actionBar.setDisplayHomeAsUpEnabled(true);
    }
}
```
【注】当解析XML资源时，Android会忽略当前设备不支持的XML属性。所以我们可以安全地使用较新版本的XML属性，而不需要担心旧版本Android遇到这些代码时会崩溃。例如如果我们设置targetSdkVersion="11"，app会在Android 3.0或更高时默认包含ActionBar。然后添加menu items到action bar时，我们需要在自己的menu XML资源中设置android:showAsAction="ifRoom"。在跨版本的XML文件中这么做是安全的，因为旧版本的Android会简单地忽略showAsAction属性(就是这样，你并不需要用到res/menu-v11/中单独版本的文件)
### 使用平台风格和主题
Android提供了用户体验主题，为app提供基础操作系统的外观和体验。这些主题可以在manifest文件中被应用于app中。通过使用内置的风格和主题，我们的app自然地随着Android新版本的发布，自动适配最新的外观和体验.

使activity看起来像对话框:
```xml
<activity android:theme="@android:style/Theme.Dialog">
```
使activity有一个透明背景:
```xml
<activity android:theme="@android:style/Theme.Translucent">
```
应用在/res/values/styles.xml中定义的自定义主题:
```xml
<activity android:theme="@style/CustomTheme">
```
更多关于创建和使用主题，详见[Styles and Themes](https://developer.android.com/guide/topics/ui/themes.html)





